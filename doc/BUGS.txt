name: wxShtoom call setup confused
to reproduce: run shtoom with wx GUI, call it from another shtoom
details: wx Shtoom opens audio channel before user decides whether to accept or decline call; exceptions in log
more details: I've spent way too many hours trying to fix this without success.  You are more than welcome to see my patches, but they don't fix it properly -- after my patches audio channel doesn't get opened prematurely, but there is an exception with cookie=None passed to the acceptedCall() callback, so the call never starts at all.

name: reject first call, second call exception
to reproduce: using test harness I reject a call then have another incoming call
details: 
          File "./shtoom/shtoom/test/harness.py", line 168, in main
            p.start()
          File "/home/zooko/playground/shtoom/darcsworld/shtoom/shtoom/app/phone.py", line 71, in start
            reactor.run()
          File "/usr/lib/python2.3/site-packages/twisted/internet/default.py", line 126, in run
            self.mainLoop()
          File "/usr/lib/python2.3/site-packages/twisted/internet/default.py", line 134, in mainLoop
            self.runUntilCurrent()
        --- <exception caught here> ---
          File "/usr/lib/python2.3/site-packages/twisted/internet/base.py", line 423, in runUntilCurrent
            call.func(*call.args, **call.kw)
          File "./shtoom/shtoom/test/harness.py", line 88, in checkForCallFile
            self.dropFakeInbound('foo')
          File "./shtoom/shtoom/test/harness.py", line 122, in dropFakeInbound
            self.c.terminateCall()
          File "./shtoom/shtoom/test/harness.py", line 64, in terminateCall
            self.sip.app.endCall(self.cookie)
        exceptions.AttributeError: TestCall instance has no attribute 'cookie'


When the audio device is busy, bad things happen:

2004/09/26 17:53 EST [shtoom.sip.SipPhone (UDP)] startCall reopening None
<MediaLayer wrapped around <shtoom.audio.ossaudio.OSSAudioDevice object at
0xf69948ac>>

2004/09/26 17:53 EST [shtoom.sip.SipPhone (UDP)] Traceback (most recent call
last):
          File
"/usr/local/lib/python2.3/site-packages/twisted/python/context.py", line 43,
in callWithContext
            return func(*args,**kw)
          File
"/usr/local/lib/python2.3/site-packages/twisted/internet/default.py", line
535, in _doReadOrWrite
            why = getattr(selectable, method)()
          File
"/usr/local/lib/python2.3/site-packages/twisted/internet/udp.py", line 114, in
doRead
            self.protocol.datagramReceived(data, addr)
          File "/home/anthony/projects/shtoom/svntrunk/shtoom/sip.py", line
1081, in datagramReceived
            mp.dataReceived(datagram)
        --- <exception caught here> ---
          File
"/usr/local/lib/python2.3/site-packages/twisted/protocols/sip.py", line 554,
in dataReceived
            basic.LineReceiver.dataReceived(self, data)
          File
"/usr/local/lib/python2.3/site-packages/twisted/protocols/basic.py", line 233,
in dataReceived
            return self.rawDataReceived(data)
          File
"/usr/local/lib/python2.3/site-packages/twisted/protocols/sip.py", line 641,
in rawDataReceived
            self.messageDone()
          File
"/usr/local/lib/python2.3/site-packages/twisted/protocols/sip.py", line 621,
in messageDone
            self.messageReceived(self.message)
          File "/home/anthony/projects/shtoom/svntrunk/shtoom/sip.py", line
1143, in sipMessageReceived
            call.recvResponse(message)
          File "/home/anthony/projects/shtoom/svntrunk/shtoom/sip.py", line
742, in recvResponse
            self.sendAck(message, startRTP=1)
          File "/home/anthony/projects/shtoom/svntrunk/shtoom/sip.py", line
573, in sendAck
            self.sip.app.startCall(self.cookie, oksdp, cb)
          File "/home/anthony/projects/shtoom/svntrunk/shtoom/app/phone.py",
line 146, in startCall
            self._audio.reopen()
          File
"/home/anthony/projects/shtoom/svntrunk/shtoom/audio/converters.py", line 222,
in reopen
            NullConv.reopen(self)
          File
"/home/anthony/projects/shtoom/svntrunk/shtoom/audio/converters.py", line 36,
in reopen
            return self._d.reopen()
          File
"/home/anthony/projects/shtoom/svntrunk/shtoom/audio/baseaudio.py", line 15,
in reopen
            self.openDev()
          File
"/home/anthony/projects/shtoom/svntrunk/shtoom/audio/ossaudio.py", line 10, in
openDev
            dev = ossaudiodev.open('rw')
        exceptions.IOError: [Errno 16] Device or resource busy: '/dev/dsp'
        
name: dropcall in state 'SENT_RINGING' not handled
to reproduce: Make a call. Wait until in state 180: Ringing. On the other end, reject the call.
details:
[02:51] 	<fezzae>	2004/11/10 02:51 PST [-] dropcall in state 'SENT_RINGING'
[02:52] 	<fezzae>	but the other side still says 180: Ringing
[02:58] 	<fezzae>	the 'SENT_RINGING' state isn't handled
[02:58] 	*	fezzae adds it to the 'SENT_INVITE' tuple and sees
[02:58] 	<`anthony>	not sure whether you're meant to send back a BYE or a CANCEL in that state.
[03:00] 	<fezzae>	ah.


